# â˜•ï¸ AUTOCAZING PORTING MANUAL

## ëª©ì°¨

1. í™˜ê²½ ì„¤ì •
2. ë°°í¬
3. ì™¸ë¶€ ì„œë¹„ìŠ¤
4. ì‹œì—° ì‹œë‚˜ë¦¬ì˜¤

## 1. í™˜ê²½ ì„¤ì •

### ğŸ”¨ ê°œë°œ í™˜ê²½

-   FrontEnd
    -   IDE : VisualStudio Code
    -   Node v20.11.0
    -   CRA v5.1.6 & React v18.2.0
    -   Vite-Plugin-PWA v0.19.7
-   BackEnd
    -   IDE : IntelliJ
    -   JDK 17.0.9(zulu)
    -   SpringBoot v3.1.5
    -   SpringCloud v2022.0.4
-   InfraStructure
    -   server : ubuntu v20.04
    -   nginx v1.18.0
    -   docker v26.1.0
    -   ## docker compose v2.26.1
        -   MySQL mysql:latest
        -   Kafka bitnami/kafka:3.5.1-debian-11-r44
        -   registry registry
        -   jenkins jenkins/jenkins:jdk17

### âœ… Nginx ì„¤ì¹˜

```jsx
$ sudo apt-get install nginx
```

### âœ… Encrypt(SSL ë°œê¸‰)

```jsx
$ sudo apt-get install letsencrypt
$ sudo letsencrypt certonly --standalone -d [ë„ë©”ì¸]
```

### ğŸ“‹ Nginx ì„¤ì •

```
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# https://www.nginx.com/resources/wiki/start/
# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
# https://wiki.debian.org/Nginx/DirectoryStructure
#
# In most cases, administrators will remove this file from sites-enabled/ and
# leave it as reference inside of sites-available where it will continue to be
# updated by the nginx packaging team.
#
# This file will automatically load configuration files provided by other
# applications, such as Drupal or Wordpress. These applications will be made
# available underneath a path with that package name, such as /drupal8.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#
server {

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	root /var/www/html;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name k10e204.p.ssafy.io;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ /index.html =404;
	}

	# pass PHP scripts to FastCGI server
	#
	#location ~ \.php$ {
	#	include snippets/fastcgi-php.conf;
	#
	#	# With php-fpm (or other unix sockets):
	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
	#	# With php-cgi (or other tcp sockets):
	#	fastcgi_pass 127.0.0.1:9000;
	#}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}

	# -------------- For MSA section --------------
	# API Gateway server
	location /api {
                proxy_pass  http://localhost:8080;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
        }

	# SSE endpoint
    	location /api/alerts/connect {
        	proxy_pass http://localhost:8080;
        	proxy_http_version 1.1;
        	proxy_set_header Connection '';
        	proxy_buffering off;
        	proxy_set_header Host $host;
        	proxy_set_header X-Real-IP $remote_addr;
        	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        	proxy_set_header X-Forwarded-Proto $scheme;

		# Add these timeout settings
        	proxy_read_timeout 24h;
       		proxy_send_timeout 24h;
        	proxy_connect_timeout 24h;
    	}

	# Config Server
        location /msa/config/ { # ëì— /ë¥¼ í•´ì£¼ì§€ ì•Šìœ¼ë©´ ë‹¨ìˆœíˆ í¬íŠ¸ ì—°ê²°ë§Œ ìˆ˜í–‰í•˜ë©°, /msa/config ì´í›„ì˜ ê²½ë¡œëŠ” ì „ë‹¬í•˜ì§€ ì•ŠìŒ
                proxy_pass  http://localhost:8888/;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
	    	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  		proxy_set_header X-Forwarded-Proto $scheme;
        }

    listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/k10e204.p.ssafy.io/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/k10e204.p.ssafy.io/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot


}

# Virtual Host configuration for example.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
#server {
#	listen 80;
#	listen [::]:80;
#
#	server_name example.com;
#
#	root /var/www/example.com;
#	index index.html;
#
#	location / {
#		try_files $uri $uri/ =404;
#	}
#}

server {
    if ($host = k10e204.p.ssafy.io) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


	listen 80 default_server;
	listen [::]:80 default_server;

	server_name k10e204.p.ssafy.io;
    return 404; # managed by Certbot
}
```

### âœ… Docker ì„¤ì¹˜

#### Set up the repository

1. Update the `apt` package index and install packages to allow `apt` to use a repository over HTTPS:

```
$ sudo apt-get update
$ sudo apt-get install \\
    ca-certificates \\
    curl \\
    gnupg \\
    lsb-release
```

2. Add Docker's official GPG key

```
$ sudo install -m 0755 -d /etc/apt/keyrings
$ sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
```

3. Use the following command to set up the repository

```
$ echo \\
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] <https://download.docker.com/linux/ubuntu> \\
$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

#### Install Docker Engine

1. Update the apt package index

```
$ sudo apt-get update
```

2. Install Docker Engine, containerd, and Docker Compose

```
$ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

### âœ… PostgreSQL ì„¤ì¹˜ì™€ ì‹¤í–‰

```
$ sudo docker pull postgres
$ sudo docker run -d -p <Your>:<Port> -e POSTGRES_PASSWORD="<YourStrong@Passw0rd>" --name <YourContainerName> postgres
```

### âœ… Redis ì„¤ì¹˜ì™€ ì‹¤í–‰

```
$ sudo docker pull redis
$ sudo docker run -d -p <Your>:<Port> --name <YourConatinerName> redis
```

### ğŸ“‹ í”„ë ˆì„ì›Œí¬ ì„¤ì • íŒŒì¼ ë‚´ìš©

```jsx
---------React---------
.env ë‚´ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

VITE_TMAP_API_KEY='{key}'
VITE_KAKAOMAP_API_KEY='{key}'
VITE_KAKAOMAP_REST_API_KEY='{key}'

---------Spring---------
application.yml ë‚´ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

spring :
    profiles:
        active: ${profile}
    output:
        ansi:
            enabled: ALWAYS
    servlet:
        multipart:
            max-file-size: 50MB
            max-request-size: 50MB
#logging
logging:
    level:
        root: info
        org:
            hibernate:
                orm:
                    jdbc:
                        bind: trace
    pattern:
        file: "%d %-5level [%thread] %logger : %msg%n"
#swagger
springdoc:
    packages-to-scan: com.dororo.api
    default-consumes-media-type: application/json;charset=UTF-8
    default-produces-media-type: application/json;charset=UTF-8
    api-docs:
        path: /api/api-docs
    swagger-ui:
        path: /api/docs # Swagger í˜ì´ì§€ë¡œ ì ‘ì†í•  ê²½ë¡œ
        disable-swagger-default-url: true   # ê¸°ë³¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜ ë˜ì§€ ì•Šê²Œ í•˜ëŠ” ì„¤ì •ì…ë‹ˆë‹¤
        operations-sorter: alpha    # APIë¥¼ ì—”ë“œ í¬ì¸íŠ¸ë“¤ì˜ ì•ŒíŒŒë²³ ìˆœì„œë¡œ ì •ë ¬
        enabled: true   # ì™¸ë¶€ì—ì„œ ì ‘ì† ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ì„¤ì •

----------------------------------------------------------------------

application-{profile}.yml ë‚´ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

secret-key: {secret-key}
spring :
  data:
    redis:
      host: {host-url}
      port: 6379
  security:
    oauth2:
      client:
        registration:
          naver:
            client-id: {id}
            client-secret: {secret}
            redirect-uri: '{baseUrl}/oauth2/callback/naver'
            authorization-grant-type: authorization_code
            scope: name
        provider:
          naver:
            authorization-uri: https://nid.naver.com/oauth2.0/authorize
            token-uri: https://nid.naver.com/oauth2.0/token
            user-info-uri: https://openapi.naver.com/v1/nid/me
            user-name-attribute: response
  datasource:
    driver-class-name: org.postgresql.Driver
    url: jdbc:postgresql://{domain/db-name}
    username: {username}
    password: {password}
  jpa:
    show-sql: true
    hibernate:
      ddl-auto: none
      format_sql: true
      jdbc:
        lob:
          non_contextual_creation: true
    database: postgresql
    database-platform: org.hibernate.spatial.dialect.postgis.PostgisPG95Dialect
cloud:
  aws:
    region:
      static: ap-northeast-2
      auto: false # ìë™ region íƒì§€ ì˜µì…˜. falseë¡œ ì„¤ì •í–ˆìœ¼ë¯€ë¡œ ìœ„ì˜ ap-northeast-2(ì„œìš¸ region)ìœ¼ë¡œ ì ìš© ë¨
    s3:
      bucket: {bucket-name}
    stack:  # AWS CloudFormation ìŠ¤íƒê³¼ ì—°ë™í•˜ì—¬ ë¦¬ì†ŒìŠ¤ì˜ ìë™ ê°ì§€ ë° êµ¬ì„±ì„ í™œì„±í™” í•  ì§€ ì—¬ë¶€. falseëŠ” CloudFormation ìŠ¤íƒì„ í†µí•œ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ë‚˜ ìë™ ê°ì§€ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê² ë‹¤ëŠ” ì˜ë¯¸
      auto: false
    credentials:
        access-key: {key}
        secret-key: {key}
```

## 2. ë°°í¬

### ğŸš€ ìˆ˜ë™ë°°í¬ ë°©ë²•

1. ì†ŒìŠ¤ ì½”ë“œ ë³µì œ

    $ git clone https://lab.ssafy.com/s10-bigdata-recom-sub2/S10P22E202.git

2. FrontEnd

```
$ cd /path-to-git-directory/client
$ npm ci
$ npm run build
$ sudo rm -rf /var/www/html/* && sudo cp -r /home/ubuntu/cd_client/* /var/www/html/
```

3. BackEnd

```
$ cd /path-to-git-directory/server
$ chmod +x gradlew
$ ./gradlew build
$ cd /build/libs
$ nohup java -jar -Dspring.profiles.active={your-want-profile} dororo-0.0.1-SNAPSHOT.jar
```

---

## 3. ì™¸ë¶€ ì„œë¹„ìŠ¤

### ğŸ” ì†Œì…œ ë¡œê·¸ì¸

[ë„¤ì´ë²„ ë¡œê·¸ì¸](https://developers.naver.com/docs/login/overview/overview.md)

1. ë„¤ì´ë²„ ê°œë°œì ì„¼í„°ì—ì„œ ë‚´ ì–´í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡
2. API ì„¤ì •, Callback URL, ì„œë¹„ìŠ¤ URL ì§€ì •

### ğŸŒ ì§€ë„

TMAP

1. [SK Open API](https://openapi.sk.com/) ì•± ë“±ë¡
2. PRODUCTS -> TMAP ì˜† API ë²„íŠ¼ í´ë¦­ -> ìš°ì¸¡ ìƒë‹¨ ê°œë°œ ê°€ì´ë“œ í´ë¦­ -> ìŠ¤í¬ë¡¤ í›„ ì¤‘ê°„ì¯¤ "êµ¬ë§¤ë¥¼ ì›í•˜ì‹œë©´ ì—¬ê¸°ë¥¼ í´ë¦­" í•˜ì´í¼ í…ìŠ¤íŠ¸ í´ë¦­ -> ì•± ë“±ë¡
3. [TMAP ê¸°ëŠ¥](https://openapi.sk.com/products/detail?svcSeq=4&menuSeq=3) ì°¸ê³ í•˜ì—¬ í•„ìš”í•œ API ì‚¬ìš©

Kakao Map

1. [ì¹´ì¹´ì˜¤ ê°œë°œì ì„¼í„°](https://developers.kakao.com/) ì•± ë“±ë¡
2. [MAPS API](https://apis.map.kakao.com/web/) ì°¸ê³ í•˜ì—¬ í•„ìš”í•œ API ì‚¬ìš©

---

## 4. ì‹œì—° ì‹œë‚˜ë¦¬ì˜¤

### 1. ëœë”© í˜ì´ì§€ & ë¡œê·¸ì¸

<img src = ./assets/landing.gif width=165 height = 330/>

### 2. ì½”ìŠ¤ ì¶”ì²œ

<img src = ./assets/findlocation.gif width=165 height = 330/> <img src = ./assets/createoption.gif width=165 height = 330/>
<img src = ./assets/createcomplete.gif width=165 height = 330/>

### 3. ì½”ìŠ¤ ì €ì¥

<img src = ./assets/selectcourse.gif width=165 height = 330/>

### 4. ì½”ìŠ¤ ì£¼í–‰

<img src = ./assets/drive.gif width=165 height = 330/>

### 5. ì½”ìŠ¤ ì»¤ìŠ¤í…€

<img src = ./assets/custom.gif width=165 height = 330/>
